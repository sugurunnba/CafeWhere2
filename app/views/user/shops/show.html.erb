<div class="container">
  <div class="row">
    <div class="col-md-offset-1 col-md-10">
      <table class="table">
        <thead>
          <h3 class="text-center"><%= @shop.name %>の詳細ページ</h3>
        </thead>
        <tbody>
          <tr>
            <th>店名</th>
            <td><%= @shop.name %></td>
          </tr>
          <tr>
            <th>お店の紹介文</th>
            <td><%= @shop.introduction %></td>
          </tr>
          <tr>
            <th>お店の写真</th>
            <td><%= attachment_image_tag @shop, :shop_image, :fill, 100, 100 %></td>
          </tr>
          <tr>
            <th>住所</th>
            <td>
              <%= @shop.address %>
              <% if @shop.latitude.present? && @shop.longitude.present? %>
              <script type="text/javascript">
                function initMap() {
              // latitude,longitudeから位置を特定
                  var test ={lat: <%= @shop.latitude %>, lng: <%= @shop.longitude %>};
                  var map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 15,
                            center: test
                            });
                  var transitLayer = new google.maps.TransitLayer();
                  transitLayer.setMap(map);

                  var contentString = '住所：<%= @shop.address %>';
                  var infowindow = new google.maps.InfoWindow({
                    content: contentString
                  });

              // Map上の指定した位置にピンを挿して表示する
                  var marker = new google.maps.Marker({
                                position:test,
                                map: map,
                                title: contentString
                               });

                   marker.addListener('click', function() {
                     infowindow.open(map, marker);
                   });
                }
              </script>

              <!--以下の記述の中にあるYOUR_API_KEYには取得したご自身のAPIキーを記述してください-->
              <script async defer src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV["GOOGLE_MAP_API_KEY"] %>&callback=initMap">
              </script>
              <!--表示するmapのcssです。ご自身でカスタマイズしてください。高さが設定されていないと表示されないことがあります。-->
              <style type="text/css">
                #map { height: 200px;
                       width: 70%;}
              </style>

              <!--mapの表示-->
              <div id="map"></div>
              <% else %>
              <p>表示することができません</p>
              <% end %>
            </td>
          </tr>
          <tr>
            <th>ジャンル</th>
            <td><%= @shop.genre.name %></td>
          </tr>
          <tr>
            <th>営業時間</th>
             <td><%= @shop.start_business_hours %>~<%= @shop.finish_business_hours %></td>
          </tr>
          <tr>
            <th>最寄駅</th>
            <td><%= @shop.station %></td>
          </tr>
          <tr>
            <th>電話番号</th>
            <td><%= @shop.phone_number %></td>
          </tr>
          <tr>
            <th>ホームページ</th>
            <td>
              <%= link_to "https://tabelog.com/kyoto/A2601/A260202/26017496/" do %>
                ここをクリックしてホームページを見に行く
              <% end %>
            </td>
          </tr>
          <tr>
            <th>休日</th>
             <td><%= @shop.holiday %></td>
          </tr>
          <tr>
          <% if @shop.bookmarked_by?(current_user) %>
            <td><%= link_to "ブックマークを外す", user_shop_bookmarks_path(@shop.id), method: :delete %></td>
          <% else %>
            <td><%= link_to "ブックマークする", user_shop_bookmarks_path(@shop.id), method: :post %></td>
          <% end %>
          <td><%= link_to "評価する", new_user_shop_review_path(@shop.id) %></td>
          </tr>
          <tr>
          <!--route.rbにて、idが含まれていれば、引数が必要-->

            <td><%= link_to "戻る", 'javascript:history.back()' %></td>
          </tr>
        </tbody>
      </table>


      <table>
        <% @shop.reviews.each do |review| %>
        <thead>
          <tr>
            <h3 class="text-center">クチコミ</h3>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th class="review-rating" data-score="<%= review.rate %>"></th>
            <td>
              <%= link_to user_shop_review_path(review) do %>
                <%= review.title %>
              <% end %>
            </td>
          </tr>
        </tbody>
        <% end %>

        <script>
          $('.review-rating').raty({
            readOnly: true,
            score: function() {
              return $(this).attr('data-score');
            },
            path: '/assets/'
          });
        </script>
      </table>

    </div>
  </div>
</div>








<!--一からな無いものを作るより、既成のコードを書いた後に、理解を進めた方がよい-->
<!--巨人の肩に乗る、車輪の再発明をさける-->